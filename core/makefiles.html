<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" value="Writing Makefiles (at 42)">
        <meta property="og:image" value="../src/Images/42_logo.png">
        <title>Writing Makefiles (at 42)</title> <!-- or core/makefiles.html -->
                <link rel="stylesheet" href="../fonts.css">
                <link rel="stylesheet" href="../style.css">
        <link rel="stylesheet" href="../pygments.css">
    </head>
    <body>
        <header>
            <nav>
                <a class="nav-logo" href="../index.html">
                                        <!--<h3>Mastering</h3> -->
                    <img src="../src/Images/42_logo_big.jpg" alt="Mastering 42">
                </a>
                <input type="checkbox" name="hamburger-button" id="nav-toggle">
                <div class="nav-list">
                    <a href="../holy_graph/index.html" class="nav-item">holy_graph</a><a href="index.html" class="nav-item active">core</a><a href="../cs_theory/index.html" class="nav-item">cs_theory</a>
                </div>
                <label for="nav-toggle"></label>
            </nav>
        </header>
        <main>
            <div class="sidenav">
           <div class="nav-node"></div><div class="nav-node"><a href="index.html"><span class="category">core</span></a><div class="nav-node"><a href="vscode_debugger.html">VSCode Debugger</a></div><div class="nav-node active"><a href="makefiles.html">Writing Makefiles (at 42)</a><div class="nav-node"><a href="#Why Makefiles?">Why Makefiles?</a></div><div class="nav-node"><a href="#The Base">The Base</a></div><div class="nav-node"><a href="#Pointers">Pointers</a></div></div></div><div class="nav-node"></div>
            </div>
            <div class="content">

                <root><div class="title"><h1>Writing Makefiles (at 42)</h1><h4 class="subhead">by bhagenlo</h4></div><linked class="heading"><h2 id="Why Makefiles?"><a class="heading-anchor" href="#Why Makefiles?">#</a>Why Makefiles?</h2></linked><br/>Makefiles are there to automate the build process for us. They get used by <code>make</code> for compiling programs according to the rules in them.<p>The idea is that, in the end, we only have to write</p><div class="highlight"><pre><code>λ make
...</code></pre></div><p>instead of</p><div class="highlight"><pre><code>λ gcc a.c b.c c.c ... libft.a -o my_program
...</code></pre></div><p>And trust me, it is worth it – especially when there are recursive calls to other Makefiles involved.</p><details open=""><summary><linked class="heading"><h2 id="The Base"><a class="heading-anchor" href="#The Base">#</a>The Base</h2></linked></summary><p>Okay. What do we need for the absolute minimum?</p><figure><blockquote>We need the rules <code>$NAME</code>, <code>all</code>, <code>clean</code>, <code>fclean</code>, and <code>re</code>, and that it does not relink.</blockquote></figure><linked class="heading"><h3 id="Rules"><a class="heading-anchor" href="#Rules">#</a>Rules</h3></linked><br/>A <i>rule</i> consists of a <i>target</i>, <i>prerequisites</i> for that target, and commands to execute. The commands are regular commands you could execute on a shell.<div class="highlight"><pre><code>&lt;target&gt; : &lt;prerequisite 1&gt; &lt;prerequisite 2&gt;
        &lt;command 1&gt;
        &lt;command 2&gt;</code></pre></div><linked class="heading"><h3 id="Variables"><a class="heading-anchor" href="#Variables">#</a>Variables</h3></linked><br/>A <i>variable</i> consists of a <i>name</i> and a (or multiple) <i>value(s)</i>, chained together by either <code>=</code> or <code>:=</code>.<ul><li>The name is written in UPPERCASE by convention.</li><li>The values are comma-separated, and consist of strings.</li></ul><div class="highlight"><pre><code>VARNAME = string1
# ...
VARNAME2 = file1.c file2.c somefolder/subfile0.c bla.c \
        foo.c bar.c</code></pre></div><p>The <code>\</code> at the end is a line-separator for <code>make</code> :)</p><linked class="heading"><h3 id="all"><a class="heading-anchor" href="#all">#</a><code>all</code></h3></linked><ul><li>Higly likely to be the first rule in your Makefile, as your first rule gets called implicitly when just calling <code>make</code> without parameters.</li><li>Consists usually only of <code>$(NAME)</code> (as a prerequisite), but also all the other startup chores you want/need to do.</li></ul><div class="highlight"><pre><code>NAME := libft.a
# ...
all : $(NAME)
</code></pre></div><linked class="heading"><h3 id="$(NAME)"><a class="heading-anchor" href="#$(NAME)">#</a><code>$(NAME)</code></h3></linked><ul><li>The rule where the compilation happens.</li><li>Since it needs the object (<code>.o</code>) files, state them as prerequisites.</li><li>And then follows your compilation, library creation, whatever you are doing :)</li></ul><div class="highlight"><pre><code>SRCS := a.c
OBJS := a.o
# ...
$(NAME) : $(OBJS)
        ar rcs $(NAME) $(OBJS)

$(OBJS) :
        cc -Wall -Werror -Wextra -c $(SRCS)
</code></pre></div><linked class="heading"><h3 id="clean"><a class="heading-anchor" href="#clean">#</a><code>clean</code></h3></linked><br/>Should clean all the object files, but not your output file(s). Therefore, pretty staightforward:<div class="highlight"><pre><code>clean :
        rm -f $(OBJS)</code></pre></div><linked class="heading"><h3 id="fclean"><a class="heading-anchor" href="#fclean">#</a><code>fclean</code></h3></linked><br/>Should clean all the object files + your output file(s).<div class="highlight"><pre><code>fclean : clean
        rm -f $(NAME)</code></pre></div><linked class="heading"><h3 id="re"><a class="heading-anchor" href="#re">#</a><code>re</code></h3></linked><br/>And, last but not least, <code>re</code>. It should run <code>fclean</code>, then recompile.<div class="highlight"><pre><code>re : fclean
        $(MAKE) all</code></pre></div></details><details open=""><summary><linked class="heading"><h2 id="Pointers"><a class="heading-anchor" href="#Pointers">#</a>Pointers</h2></linked></summary><ul><li><a href="https://www.gnu.org/software/make/manual/html_node/index.html#Top">The GNU make Documentation</a></li><li><a href="https://makefiletutorial.com/">A very extensive tutorial</a></li></ul></details></root>
                <div class="adjacent-nav">

                                        <div id="contrib">Found something to improve? Edit this page on <a href=https://github.com/haglobah/Mastering-42/edit/main/core/makefiles.poly.pm target="_blank"> Github</a>!</div>

                </div>
            </div>
        </main>
    <footer>
        <p class="copyright">
            2022
        </p>
        <div class="links">
            <a href="legal.html">Legal</a>
            <!-- <a href="impressum.html">Impressum</a> -->
        </div>
    </footer>
    <script src="../get-path.js"></script>
</body>
</html>
